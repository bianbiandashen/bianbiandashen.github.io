
---
layout:     post
title:      在 vue 中使用高阶组件
subtitle:   
date:       2019-9-29
author:    	BIANBIAN
header-img: img/post-bg-cook.jpg
catalog: true
tags:
    - Vue
    - hook
---

## 1.1 概念
用过 React 开发过项目的人, 想必高阶组件这个词汇应该是非常熟悉的.

高阶组件(Higher-Order Components
, 简称 HOC)是对代码复用的一种常用手段, 它实际上是一个接收 组件参数并返回新组件的函数.

在 vue 中, 我们通常会用 mixins 分发可复用的功能, 然而 mixin 是一种侵入式的方式, 它会用浅合并的形式改变原有的组件对象, 同时原有的被 mixin 组件会依赖 mixin 组件.

因此, 高阶组件可以解决 mixin 会遇到的问题, 它是无副作用的组件, 它不应该改变原组件. 





## 1.2 examples

1. 每一行渲染 `cols` 个 `item-component` 组件
```javascript

<div class="m-list-wrapper-row">
  <item-component v-for="item in cols"></item-component>
</div>


```

2. rows 行渲染 cols 个 `item-component` 组件
```javascript

<div class="m-list-wrapper-row" v-for="rowItem in rows">
  <item-component v-for="item in cols"></item-component>
</div>


```
3. 一维数组转为 rows 行 cols 列的二维数组, 可以使用 lodash 中的 `chunk` 工具函数进行切割.
 
4. 高阶组件是一个组件函数, 因此这里需要用到 vue 中的渲染函数 `render`( 渲染函数 & JSX )

## 1.3 `m-list-wrapper.vue` 高阶组件:


```javascript
import './index.less'
import _chunk from 'lodash/chunk'

export default function MListWrapper (WrappedComponent) {
  return {
    props: {
      // 一维列表数据数组
      data: {
        type: Array,
        default: () => {
          return []
        }
      },
      // 排布列数
      cols: {
        type: Number,
        default: 2
      },
      // 行间距
      rowSpace: {
        type: String,
        default: ''
      }
    },
    render (createElement) {
      // 将列表一维数组数据切割为 chunkData.length 行 cols 列 的二维数组
      const chunkData = _chunk(this.data, this.cols)
      const rowSpace = this.rowSpace

      return createElement('div',
        // 创建最外层容器 div
        {
          class: 'm-list-wrapper'
        },
        chunkData.map(function (rowData, rowIndex) {
          // 循环渲染 chunkData.length 行元素
          return createElement('div',
            {
              class: 'm-list-wrapper-row',
              style: {
                'margin-top': rowIndex > 0 ? rowSpace : 0
              }
            }, rowData.map(function (wrappedItem) {
              // 循环渲染 rowData.length 列 WrappedComponent 元素
              return createElement(WrappedComponent,
                {
                  props: wrappedItem
                }
              )
            })
          )
        })
      )
    }
  }
}

```



## 1.4 `home-product-item.vue`  组件:


```javascript
<template>
  <div class="home-product-item">
    <div class="main">
      <m-icon
        :icon-class-name="icon"
        :width="iconWidth"
        :height="iconHeight"></m-icon>
      <p>{{ title }}</p>
    </div>
  </div>
</template>

<script>
import MIcon from '~/components/m-icon'

export default {
  name: 'home-product-item',
  components: {
    MIcon
  },
  props: {
    icon: {
      type: String,
      default: ''
    },
    iconWidth: {
      type: String,
      default: ''
    },
    iconHeight: {
      type: String,
      default: ''
    },
    title: {
      type: String,
      default: ''
    }
  }
}
</script>
```


## 1.5 `home.vue` 组件:

```
<template>
  <div>
    // code
    <home-product-list
        row-space=".2rem"
        :cols="2"
        :data="productList"></home-product-list>
    // code
    <home-customer-list
        row-space=".3rem"
        :cols="3"
        :data="customerList"></home-customer-list>
    // code
  </div>
</template>

<script>
import MListWrapper from '~/components/m-list-wrapper'
import HomeProductItem from '~/components/home-product-item'
import HomeCustomerItem from '~/components/home-customer-item'

const HomeProductList = MListWrapper(HomeProductItem)
const HomeCustomerList = MListWrapper(HomeCustomerItem)

export default {
  name: 'home',
  components: {
    HomeProductList,
    HomeCustomerList
  },
  data () {
    return {
      productList: [{
        icon: 'icon-manufacture',
        iconWidth: '.48rem',
        iconHeight: '.3rem',
        title: '智能制造'
      }, ...]
      customerList: [{
        name: '比亚迪汽车',
        imgUrl: '/images/customer/biyadi.png'
      }, ...]
    }
  }
}
</script>

```


##为什么在 Vue 中实现高阶组件比较难

前面说过要分析一下为什么在 Vue 中实现高阶组件比较复杂而 React 比较简单。这主要是二者的设计思想和设计目标不同，在 React 中写组件就是在写函数，函数拥有的功能组件都有。而 Vue 更像是高度封装的函数，在更高的层面 Vue 能够让你轻松的完成一些事情，但与高度的封装相对的就是损失一定的灵活，你需要按照一定规则才能使系统更好的运行。

有句话说的好：

##会了不难，难了不会

##复杂还是简单都是相对而言的，最后希望大家玩的转 Vue 也欣赏的了 React 。

